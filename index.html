<!DOCTYPE HTML>
<!--
	Big Picture by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Save Freddy</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/styleYoutube.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
				<link rel="stylesheet" href="assets/css/style.css">
		<style type="text/css">

		.container{
			background: none;
		}
		.main.style1 .content{
			position: absolute;
			top: 40%;	
			margin: auto;
			left: 0;
			right: 0;
		}
		#breath{
			width: 100%;
			position: absolute;
			bottom: 0;
		}
		
		#myProgress {
			width: 100%;
			height: 10px;
			position: relative;
			background-color: #ddd;
		}

		#myBar {
			background-color: #c23a2c;
			width: 10px;
			height: 10px;
			position: absolute;
		}
		.overEverything{
			z-index: 999;
		}

		</style>
	</head>
	<body>

		<!-- Header -->
			<header id="header">

				<!-- Logo -->
					<h1 id="logo">Save Freddy</h1>

				<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="#intro">Intro</a></li>
							<li><a href="#one">Who's Freddy?</a></li>
							<li><a href="#reanimation">Reanimate Freddy!</a></li>
						</ul>
					</nav>

			</header>

		<!-- Intro -->
			<section id="intro" class="main style1 dark fullscreen">
				<div id="fullScreenVideo"></div>
				<div class="content container 75%">
					<header>
						<h2>Save Freddy!</h2>
					</header>
					<p>Welcome to SaveFreddy! A page to sensibilize you on the importance of not having a zombie friend. <!-- or how to partecipate at Koding's hackathon with a project made 12 hrs before the deadline, because 3 out of 5 persons of your team dropped you. -->
					<br>by <a href="http://lenotta.com">Lenotta Team (ex MagentaTeam)</a> for Koding Hackaton.

				</div>
				<a href="#one" class="button style2 down anchored overEverything">Next</a>

			</section>

		<!-- One -->
			<section id="one" class="main style2 right dark fullscreen">
                <div class="imageContainer">
                
                </div>
				<div class="content box style2" style="margin-left: -25%">
					<header>
						<h2>Who's Freddy?</h2>
					</header>
					<p>Freddy is your friend. He usually drinks a lot of sweet beverages and eats at fast foods, he doesn't like gymnastic and he loves to stay on the couch watching tv. Freddy is also your super athletic friend, who runs 35km per day and wear one of these technologic trackers. Freddy could be everyone.</p>
				</div>
				
                <a href="#warning" class="button style2 down anchored">Next</a>
			</section>
        
            <section id="warning" class="slide centeredContent">
				<div class="saveMessage">
						<h2>Oh no!</h2><br><p>Freddy just felt on the floor. He's pallid and is holding his left harm..<br>it seems like Freddy is having an<br><b>heart attack</b>!<br><br><b>GO RESCUE HIM</b><br>and save Freddy from becoming a zombie</p>
                        <a href="#reanimation" class="button style3 down anchored overEverything">Next</a>
                </div>
			</section>
		<!-- Reanimation -->
			<section id="reanimation" class="slide">
				<div id="myProgress">
						<div id="myBar"></div>
				</div>
<!-- 								<button onclick="moveProgressBar()">Click Me</button>
-->
				<div class="boxes" id="breathBox">
					<canvas id="breath">
					</canvas>
				</div>
				<div class="boxes" id="hearthBox">
					
					<div id="heartMessage"></div>
					<div id="heartCounter"></div>
				</div>
				<div id="explanation" class="centeredContent">
					
					<div class="saveMessage">
						<h2>Do you remember CPR?</h2>
						<h3>Here is a quick recap:</h3>
						<ul>
							<li>30 massages at about 2 massages per second ( use the spacebar )</li>
							<li>2 breaths ( blow in the mic )</li>

						</ul>
						<button onclick="game.startGame()">SAVE FREDDY!</button>
					</div>
				</div>
                <div id="aed" class="centeredContent reallyHide">
					
					<div class="saveMessage">
                        <h2>Click the AED to reanimate Freddy</h2>
						<img src="assets/svg/adeGreen.svg" height="200"/>
					</div>
				</div>
			</section>

		<!-- Work -->
			<section id="bolt" class="slide">
				<!-- Bolt -->
			</section>

		<!-- Contact -->
			<section id="finalGood" class="slide centeredContent reallyHide">
				<div class="saveMessage">
						<h2>YOU SAVED FREDDY!</h2>
						<p>He didn't like brains anyway...</p>

				</div>
			</section>

            <section id="finalBad" class="slide centeredContent reallyHide">
				<div class="saveMessage">
						<p>Looks like you didn't remember CPR that well and</p>
						<h2>FREDDY NOW WANTS TO EAT<br>BRAAAAAINS!</h2>
						<p>You might find him more... attractive now...</p>
						<a href="#reanimation"><button >Try Again</button></a>
				</div>
			</section>
			
            <section class="slide">
                <p></p>
            </section>
        
		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.poptrox.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script src="assets/js/jquery.youtubebackground.js"></script>
			<script type="text/javascript">
				

				$('#fullScreenVideo').YTPlayer({
						fitToBackground: true,
						videoId: '8Fw3OyQbfRM'
				});




			</script>
			<script type="text/javascript">
				
				var game = {};
				game.running = false;

				game.startGame = function(){
					
					game.reset();
					hideExplanation();
					progressBar.startTimer();
					game.startMassage();

				}

				game.reset = function(){
					game.breaths = 0;
					game.massages = 0;
					game.step = 0;
					game.rightFrequency = true;
					game.badFrequncyTimes = 0;
					game.lastMassage = 0;
					game.massageInterval = '';
					game.running = true;
					$("#heartCounter").html("");


				}

				game.endGame = function(){

					game.evaluateFrequency();

					if( game.massages == 60 && game.breaths == 4 && game.rightFrequency ){
						slideToGoodFinal();
					}else{
						slideToBadFinal();
					}

					game.running = false;
					showExplanation();
					//evaluate

				}

				game.evaluateFrequency = function(){
					if( game.badFrequncyTimes > 10 ){
						game.rightFrequency = false;
					}
				}

				game.checkLastMassageSlow = function(){

					if ( getMilliseconds() - game.lastMassage > 1000){
						game.badFrequncyTimes++;
						heartMessage("<b>FASTER</b>");
					}else{
						heartMessage("");

					}
					 
				}

				game.checkLastMassageFast = function(){

					if ( getMilliseconds() - game.lastMassage < 300){
						game.badFrequncyTimes++;
						heartMessage("<b>SLOWER</b>");
					}else{
						heartMessage("");

					}

				}

				function slideToGoodFinal(){
                    
                    jQuery('#finalGood').removeClass('reallyHide');
					jQuery("#finalGoodLink").click();
				}
				function slideToBadFinal(){
                    
                    jQuery('#finalBad').removeClass('reallyHide');
					jQuery("#finalBadLink").click();

				}

				game.startMassage = function(){
					showMassage();
					hideBreath();
					game.massageInterval = setInterval( game.checkLastMassageSlow, 500 );
				}
				
				game.endMassage = function(){
					game.step++;
					clearInterval( game.massageInterval );

					showBreath();
					game.startBreath();
				}
				
				game.startBreath = function(){
					hideMassage();


				}
				
				game.endBreath = function(){
					game.step++;

					if( game.step < 4 ){
						showMassage();
						game.startMassage();
						
					}else{
						game.endGame();
					}
				}

				game.addBreath = function(){
					if( game.step % 2 != 0){

						game.breaths++;
						if( game.breaths % 2 == 0 ){
							game.endBreath();
						}
					}

				}

				game.addMassage = function(){

					if( game.step % 2 == 0){
						game.checkLastMassageFast();
						$("#heartCounter").html(game.massages+1);
						game.massages++;
						game.lastMassage = getMilliseconds();

						if( game.massages % 30 == 0){
							if( game.step == 4 ){
								game.endGame();
							}else{
								game.endMassage();
							}
						}
					}
				}

				function getMilliseconds(){
					var d = new Date();
					return d.valueOf();
				}

				function hideExplanation(){

					$("#explanation").addClass("reallyHide");

				}				
				function showExplanation(){

					$("#explanation").removeClass("reallyHide");

				}

				function hideBreath(){
					$("#breathBox").addClass("opaque");
				}
				function showBreath(){
					$("#breathBox").removeClass("opaque");
				}
				function hideMassage(){
					$("#hearthBox").addClass("opaque");
				}
				function showMassage(){
					$("#hearthBox").removeClass("opaque");
				}

				function heartMessage( message ){
					$("#heartMessage").html(message);
				}

			</script>

			<script type="text/javascript">
				
				var progressBar = {};

				progressBar.startTimer = function() {

					progressBar.bar = document.getElementById("myBar");   
					progressBar.width = 0;
					progressBar.intervalId = setInterval(progressBar.manageProgressBar, 600);
				}

				progressBar.manageProgressBar = function() {

						if ( progressBar.width == 100) {
							clearInterval( progressBar.intervalId );
							progressBar.endTimerListener();
						} else {
							progressBar.width++; 
							progressBar.bar.style.width = progressBar.width + '%'; 
						}
				}

				progressBar.endTimerListener = function(){
					game.endGame();
				}
			</script>
			<script type="text/javascript">
						
				navigator.getUserMedia = navigator.getUserMedia ||
					navigator.webkitGetUserMedia ||
					navigator.mozGetUserMedia;

				if (navigator.getUserMedia) {
					navigator.getUserMedia({
							audio: true
						},
						function(stream) {
							audioContext = new AudioContext();
							analyser = audioContext.createAnalyser();
							microphone = audioContext.createMediaStreamSource(stream);
							javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

							analyser.smoothingTimeConstant = 0.8;
							analyser.fftSize = 1024;

							microphone.connect(analyser);
							analyser.connect(javascriptNode);
							javascriptNode.connect(audioContext.destination);

							canvasContext = document.getElementById('breath');
							canvasContext = canvasContext.getContext("2d");

							javascriptNode.onaudioprocess = function() {
									var array = new Uint8Array(analyser.frequencyBinCount);
									analyser.getByteFrequencyData(array);
									var values = 0;

									var length = array.length;
									for (var i = 0; i < length; i++) {
										values += (array[i]);
									}

									var average = values / length;
									if( average > 110 && game.running ){

										setTimeout( game.addBreath(), 1000 );
										

									}
									//console.log(Math.round(average - 40));

									canvasContext.clearRect(0, 0, 1000, 1000);
									canvasContext.fillStyle = '#BadA55';
									canvasContext.fillRect(0, 100 - average, 1000, 1000);
									

								} // end fn stream
						},
						function(err) {
							console.log("The following error occured: " + err.name)
						});
				} else {
					console.log("getUserMedia not supported");
				}
			</script>
			<script type="text/javascript">
				
				function addRedHearth(e) {
				    e = e || window.event;

				    if(e.keyCode==32 && game.running && game.step % 2 == 0){
				    	e.preventDefault();
				    	jQuery("#hearthBox").addClass("red");
				    	game.addMassage();
				    }
				}

				function removeRedHearth(e){
					e = e || window.event;
				    if(e.keyCode==32){

					    e.preventDefault();
				     	jQuery("#hearthBox").removeClass("red");

				    }
				}

				document.onkeydown = addRedHearth;
				document.onkeyup = removeRedHearth;
			</script>
			<a href="#finalGood" id="finalGoodLink" class="hide" ></a>
			<a href="#finalBad" id="finalBadLink" class="hide" ></a>

	</body>
</html>